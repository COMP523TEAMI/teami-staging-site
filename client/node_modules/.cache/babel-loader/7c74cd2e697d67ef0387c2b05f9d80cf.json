{"ast":null,"code":"import _regeneratorRuntime from\"/Users/linqiaosen/Desktop/domo/staging-demo-i/client/node_modules/babel-preset-react-app/node_modules/@babel/runtime/regenerator\";import _asyncToGenerator from\"/Users/linqiaosen/Desktop/domo/staging-demo-i/client/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/asyncToGenerator\";import _slicedToArray from\"/Users/linqiaosen/Desktop/domo/staging-demo-i/client/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/slicedToArray\";import React,{useState,useEffect}from\"react\";import{BrowserRouter as Router,Route,Switch}from\"react-router-dom\";import{Login,Register,NotFound,PageTemplate}from\"./components\";import UserContext from\"./context/UserContext\";import Axios from\"axios\";function App(){var _useState=useState({token:undefined,user:undefined}),_useState2=_slicedToArray(_useState,2),userData=_useState2[0],setUserData=_useState2[1];var url=\"/api\";useEffect(function(){var checkLoggedIn=/*#__PURE__*/function(){var _ref=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee(){var token,headers,tokenIsValid,userRes;return _regeneratorRuntime.wrap(function _callee$(_context){while(1){switch(_context.prev=_context.next){case 0:token=localStorage.getItem(\"auth-token\");if(!(token==null)){_context.next=6;break;}localStorage.setItem(\"auth-token\",\"\");token=\"\";setUserData({token:undefined,user:undefined});return _context.abrupt(\"return\");case 6:headers={\"x-auth-token\":token};_context.next=9;return Axios.post(url+\"/auth/validate\",null,{headers:headers});case 9:tokenIsValid=_context.sent;if(!tokenIsValid.data){_context.next=17;break;}_context.next=13;return Axios.get(url+\"/auth/user\",{headers:headers});case 13:userRes=_context.sent;setUserData({token:token,user:userRes.data});_context.next=18;break;case 17:setUserData({token:undefined,user:undefined});case 18:case\"end\":return _context.stop();}}},_callee);}));return function checkLoggedIn(){return _ref.apply(this,arguments);};}();checkLoggedIn();},[]);return/*#__PURE__*/React.createElement(Router,null,/*#__PURE__*/React.createElement(UserContext.Provider,{value:{userData:userData,setUserData:setUserData}},/*#__PURE__*/React.createElement(\"div\",null,/*#__PURE__*/React.createElement(Switch,null,userData.user?/*#__PURE__*/React.createElement(Route,{path:\"/\",exact:true,component:PageTemplate}):/*#__PURE__*/React.createElement(Route,{path:\"/\",exact:true,component:Register}),/*#__PURE__*/React.createElement(Route,{path:\"/login\",exact:true,component:Login}),/*#__PURE__*/React.createElement(Route,{path:\"/register\",exact:true,component:Register}),/*#__PURE__*/React.createElement(Route,{component:NotFound})))));}export default App;","map":{"version":3,"sources":["/Users/linqiaosen/Desktop/domo/staging-demo-i/client/src/App.js"],"names":["React","useState","useEffect","BrowserRouter","Router","Route","Switch","Login","Register","NotFound","PageTemplate","UserContext","Axios","App","token","undefined","user","userData","setUserData","url","checkLoggedIn","localStorage","getItem","setItem","headers","post","tokenIsValid","data","get","userRes"],"mappings":"8fAAA,MAAOA,CAAAA,KAAP,EAAgBC,QAAhB,CAA0BC,SAA1B,KAA2C,OAA3C,CACA,OAASC,aAAa,GAAIC,CAAAA,MAA1B,CAAkCC,KAAlC,CAAyCC,MAAzC,KAAuD,kBAAvD,CACA,OAASC,KAAT,CAAgBC,QAAhB,CAA0BC,QAA1B,CAAoCC,YAApC,KAAwD,cAAxD,CACA,MAAOC,CAAAA,WAAP,KAAwB,uBAAxB,CACA,MAAOC,CAAAA,KAAP,KAAkB,OAAlB,CAEA,QAASC,CAAAA,GAAT,EAAe,eACmBZ,QAAQ,CAAC,CACvCa,KAAK,CAAEC,SADgC,CAEvCC,IAAI,CAAED,SAFiC,CAAD,CAD3B,wCACNE,QADM,eACIC,WADJ,eAMb,GAAMC,CAAAA,GAAG,CAAG,MAAZ,CAEAjB,SAAS,CAAC,UAAM,CACd,GAAMkB,CAAAA,aAAa,0FAAG,0KAChBN,KADgB,CACRO,YAAY,CAACC,OAAb,CAAqB,YAArB,CADQ,MAEhBR,KAAK,EAAI,IAFO,0BAGlBO,YAAY,CAACE,OAAb,CAAqB,YAArB,CAAmC,EAAnC,EACAT,KAAK,CAAG,EAAR,CACAI,WAAW,CAAC,CAAEJ,KAAK,CAAEC,SAAT,CAAoBC,IAAI,CAAED,SAA1B,CAAD,CAAX,CALkB,wCASdS,OATc,CASJ,CACd,eAAgBV,KADF,CATI,uBAaOF,CAAAA,KAAK,CAACa,IAAN,CAAWN,GAAG,CAAG,gBAAjB,CAAmC,IAAnC,CAAyC,CAClEK,OAAO,CAAPA,OADkE,CAAzC,CAbP,QAadE,YAbc,mBAiBhBA,YAAY,CAACC,IAjBG,iDAkBIf,CAAAA,KAAK,CAACgB,GAAN,CAAUT,GAAG,CAAG,YAAhB,CAA8B,CAAEK,OAAO,CAAPA,OAAF,CAA9B,CAlBJ,SAkBZK,OAlBY,eAmBlBX,WAAW,CAAC,CACVJ,KAAK,CAALA,KADU,CAEVE,IAAI,CAAEa,OAAO,CAACF,IAFJ,CAAD,CAAX,CAnBkB,+BAwBlBT,WAAW,CAAC,CAAEJ,KAAK,CAAEC,SAAT,CAAoBC,IAAI,CAAED,SAA1B,CAAD,CAAX,CAxBkB,uDAAH,kBAAbK,CAAAA,aAAa,0CAAnB,CA4BAA,aAAa,GACd,CA9BQ,CA8BN,EA9BM,CAAT,CAgCA,mBACE,oBAAC,MAAD,mBACE,oBAAC,WAAD,CAAa,QAAb,EAAsB,KAAK,CAAE,CAAEH,QAAQ,CAARA,QAAF,CAAYC,WAAW,CAAXA,WAAZ,CAA7B,eACE,4CACE,oBAAC,MAAD,MACGD,QAAQ,CAACD,IAAT,cACC,oBAAC,KAAD,EAAO,IAAI,CAAC,GAAZ,CAAgB,KAAK,KAArB,CAAsB,SAAS,CAAEN,YAAjC,EADD,cAGC,oBAAC,KAAD,EAAO,IAAI,CAAC,GAAZ,CAAgB,KAAK,KAArB,CAAsB,SAAS,CAAEF,QAAjC,EAJJ,cAME,oBAAC,KAAD,EAAO,IAAI,CAAC,QAAZ,CAAqB,KAAK,KAA1B,CAA2B,SAAS,CAAED,KAAtC,EANF,cAOE,oBAAC,KAAD,EAAO,IAAI,CAAC,WAAZ,CAAwB,KAAK,KAA7B,CAA8B,SAAS,CAAEC,QAAzC,EAPF,cAQE,oBAAC,KAAD,EAAO,SAAS,CAAEC,QAAlB,EARF,CADF,CADF,CADF,CADF,CAkBD,CAED,cAAeI,CAAAA,GAAf","sourcesContent":["import React, { useState, useEffect } from \"react\";\r\nimport { BrowserRouter as Router, Route, Switch } from \"react-router-dom\";\r\nimport { Login, Register, NotFound, PageTemplate } from \"./components\";\r\nimport UserContext from \"./context/UserContext\";\r\nimport Axios from \"axios\";\r\n\r\nfunction App() {\r\n  const [userData, setUserData] = useState({\r\n    token: undefined,\r\n    user: undefined,\r\n  });\r\n\r\n  const url = \"/api\";\r\n\r\n  useEffect(() => {\r\n    const checkLoggedIn = async () => {\r\n      let token = localStorage.getItem(\"auth-token\");\r\n      if (token == null) {\r\n        localStorage.setItem(\"auth-token\", \"\");\r\n        token = \"\";\r\n        setUserData({ token: undefined, user: undefined });\r\n        return;\r\n      }\r\n\r\n      const headers = {\r\n        \"x-auth-token\": token,\r\n      };\r\n\r\n      const tokenIsValid = await Axios.post(url + \"/auth/validate\", null, {\r\n        headers,\r\n      });\r\n\r\n      if (tokenIsValid.data) {\r\n        const userRes = await Axios.get(url + \"/auth/user\", { headers });\r\n        setUserData({\r\n          token,\r\n          user: userRes.data,\r\n        });\r\n      } else {\r\n        setUserData({ token: undefined, user: undefined });\r\n      }\r\n    };\r\n\r\n    checkLoggedIn();\r\n  }, []);\r\n\r\n  return (\r\n    <Router>\r\n      <UserContext.Provider value={{ userData, setUserData }}>\r\n        <div>\r\n          <Switch>\r\n            {userData.user ? (\r\n              <Route path=\"/\" exact component={PageTemplate} />\r\n            ) : (\r\n              <Route path=\"/\" exact component={Register} />\r\n            )}\r\n            <Route path=\"/login\" exact component={Login} />\r\n            <Route path=\"/register\" exact component={Register} />\r\n            <Route component={NotFound} />\r\n          </Switch>\r\n        </div>\r\n      </UserContext.Provider>\r\n    </Router>\r\n  );\r\n}\r\n\r\nexport default App;\r\n"]},"metadata":{},"sourceType":"module"}